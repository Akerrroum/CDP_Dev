<% if(typeof tasks == 'undefined' || tasks.length == 0) { %>
<div class="card-header">Tâches</div>
<div class="card-body">
    <h5 class="card-title">Vous n'avez pas de tâches.</h5>
    <form action="/project/<%= project.id %>/createTask" method="GET">
        <button type="submit" class="btn btn-outline-primary">Ajouter une nouvelle tâche</button>
    </form>
</div>
<%} else {%>
<div class="jumbotron" id="taskSection">
    <h5 class="card-header">Tâches existantes</h5>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">Description</th>
                <th scope="col">Développeur</th>
                <th scope="col">État</th>
            </tr>
        </thead>
        <tbody>

            <% tasks.forEach(function (task) { %>
            <% let classCss = parseInt(task.state) > 2 ? "table-success" : "table-danger" ;%>
            <tr class=<%= classCss %>>
                <td><%= task.description %></td>
                <td><%= task.developerId %></td>
                <td><%= task.state %></td>
                <td>
                    <a href="/project/<%= project.id %>/modifyTask/<%= task.id %>"><i class="fas fa-edit fa-lg"></i></a>
                    <a href="/project/<%= project.id %>/deleteTask/<%= task.id %>"><i class="fa fa-trash fa-lg"
                            aria-hidden="true"></i></a>
                    <a href data-toggle="modal" data-target="#modalTask<%= task.id %>"><i class="fa fa-link fa-lg"
                            aria-hidden="true"></i></a>
                </td>
            </tr>
            <% });%>
        </tbody>
        <tfoot>
            <form action="/project/<%= project.id %>/createTask" method="GET">
                <button type="submit" class="btn btn-secondary">Ajouter une nouvelle tâche</button>
            </form>
        </tfoot>
    </table>
</div>

<% tasks.forEach(function (task) { %>
<div class="modal" id="modalTask<%= task.id %>">
    <div class="modal-dialog modal-lg" role="document">
        <form action="/project/<%= project.id %>/linkTask/<%= task.id %>" method="POST" class="mr-auto">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Lier une tâche à une user story</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col">Description</th>
                                <th scope="col">Difficulté</th>
                                <th scope="col">Priorité</th>
                                <th scope="col">Sélection</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-light">
                                <% project.sprints.forEach(function (sprint) { %>
                                <% sprint.userStories.forEach(function (userStory) { %>
                                    <td><%= userStory.description %></td>
                                    <td><%= userStory.difficulty %></td>
                                    <td><%= userStory.priority %></td>
                                    <td>
                                        <div class="custom-control custom-checkbox" id="checkBoxAddUserstory">
                                            <input type="checkbox" class="custom-control-input"
                                                id="customCheck<%= sprint.id %><%= userStory.id %>" name="selectedUs"
                                                value="<%= JSON.stringify(userStory) %>" unchecked>
                                            <label class="custom-control-label"
                                                for="customCheck<%= sprint.id %><%= userStory.id %>"></label>
                                        </div>
                                    </td>
                                </tr>
                                <% });%>
                                <% });%>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Lier les tâches sélectionnées à cette tâche</button>
                </div>
            </div>
        </form>
    </div>
</div>
<% });%>

<%}%>